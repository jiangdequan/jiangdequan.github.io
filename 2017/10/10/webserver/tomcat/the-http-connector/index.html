<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content=""><meta name="author" content="Jiang Dequan"><meta name="theme-color" content="#00bcd4"><link rel="icon" href="/favicon/favicon.ico"><link rel="icon" sizes="192x192" href="/images/icon/icon-192x192.png"><link rel="shortcut icon" href="/images/icon/icon-72x72.png"><link rel="apple-touch-icon" href="/images/icon/icon-72x72.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/icon/icon-72x72.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/icon/icon-144x144.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/icon/icon-180x180.png"><title>YouMayCallMeV | A Lost Programmer In The World</title><link rel="stylesheet" href="/modules/mdui/css/mdui.min.css"><link rel="stylesheet" href="/modules/ionicons/4.4.2/css/ionicons.min.css"><link rel="stylesheet" href="/css/common.css"><script src="/modules/jquery/jquery-2.2.3.min.js"></script></head><body class="mdui-theme-primary-indigo mdui-theme-accent-indigo mdui-appbar-with-toolbar mdui-drawer-body-right"><div class="simple-appbar mdui-appbar-fixed"><div class="mdui-toolbar mdui-color-indigo"> <a href="javascript:;" class="mdui-btn mdui-btn-icon" id="simple-toggle-menu"><i class="mdui-icon material-icons">&#xe5d2;</i></a> <a href="/" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">&#xe88a;</i></a><div class="mdui-text-center simple-header-title-cls" id="simple-header-title"><small href="javascript:;" class="mdui-typo-title"></small></div><div class="mdui-toolbar-spacer"></div><div class="mdui-textfield mdui-textfield-expandable mdui-float-right simple-searchbar"> <button class="mdui-textfield-icon mdui-btn mdui-btn-icon"> <i class="mdui-icon material-icons">search</i></button> <input class="mdui-textfield-input" type="text" placeholder="Search" id="simple-input-search"> <button class="mdui-textfield-close mdui-btn mdui-btn-icon"> <i class="mdui-icon material-icons">close</i></button></div></div></div><div class="mdui-drawer mdui-drawer-full-height mdui-drawer-close mdui-color-white simple-menu-cls" id="simple-menu"><div class="simple-menu-author"> <a href="/"><img class="mdui-img-circle" src="/images/avatar.png"></a><div class="mdui-typo-title">Jiang Dequan</div><p>jiangdequan1314@gmail.com</p></div><ul class="mdui-list mdui-typo"><li class="mdui-list-item mdui-ripple mdui-valign"> <a href="/"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe88a;</i> <span>&nbsp;&nbsp;Home</span></a></li><li class="mdui-list-item mdui-ripple"> <a href="/archives"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe865;</i> <span>&nbsp;&nbsp;Archives</span></a></li><li class="mdui-list-item mdui-ripple"> <a href="/categories"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe164;</i> <span>&nbsp;&nbsp;Categories</span></a></li><li class="mdui-list-item mdui-ripple"> <a href="/tags"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe54e;</i> <span>&nbsp;&nbsp;Tags</span></a></li><li class="mdui-list-item mdui-ripple"><a href="https://github.com/jiangdequan" target="_blank"><i class="mdui-list-item-icon mdui-icon ion-logo-github"></i> <span>&nbsp;&nbsp;GitHub</span></a></li><li class="mdui-list-item mdui-ripple"> <a href="/about"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe87c;</i> <span>&nbsp;&nbsp;About</span></a></li><li class="mdui-list-item mdui-ripple"> <i class="mdui-icon material-icons">&#xe8f4;</i><div class="mdui-list-item-content"><span id="busuanzi_container_site_pv"><span id="busuanzi_value_site_pv"></span></span></div> <i class="mdui-icon material-icons">&#xe851;</i><div class="mdui-list-item-content"><span id="busuanzi_container_site_uv"><span id="busuanzi_value_site_uv"></span></span></div></li></ul></div><div class="mdui-container-fluid"><div class="mdui-drawer mdui-drawer-right simple-toc-cls" id="simple-toc"><nav class="post-toc-wrap post-toc-shrink"><h4>TOC</h4><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#HTTP连接配置"><span class="post-toc-text">HTTP连接配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#标准实现"><span class="post-toc-text">标准实现</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#阻塞线程检测阀值"><span class="post-toc-text">阻塞线程检测阀值</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#说明"><span class="post-toc-text">说明</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#属性"><span class="post-toc-text">属性</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#连接数查看"><span class="post-toc-text">连接数查看</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参考文档"><span class="post-toc-text">参考文档</span></a></li></ol></li></ol></nav></div><div class="mdui-dialog simple-donation-cls" id="simple-donation"><div class="mdui-dialog-title">支持一下?</div><div class="mdui-row mdui-m-b-3"><div class="mdui-col-md-12 mdui-text-center"><p id="simple-alipay"> <img src="/images/alipay.jpg"><br> <span class="mdui-typo-title">Alipay 支付宝</span></p><p class="simple-wechat-cls" id="simple-wechat"> <img src="/images/wechat.jpg"><br> <span class="mdui-typo-title">WeChat 微信</span></p></div><div class="mdui-col-md-12 mdui-text-center"> <label class="mdui-switch" id="simple-switch"><input type="checkbox"><i class="mdui-switch-icon"></i></label></div></div></div><div class="simple-post-header"></div><div class="mdui-row" style="margin-top:-110px;z-index:9999"><div class="mdui-card mdui-col-md-7 mdui-col-offset-md-1 mdui-col-xs-12 mdui-col-offset-xs-0 mdui-shadow-12 simple-post-cls" id="simple-post"><div class="mdui-card-content mdui-typo"><h1>Tomcat之HTTP配置</h1> <small class="mdui-typo-body-2-opacity mdui-m-b-1">2017年10月10日</small><div class="mdui-center mdui-text-center"> <span id="busuanzi_container_page_pv"><del>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</del> 阅读量<span id="busuanzi_value_page_pv"></span> <del>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</del></span></div><div class="mdui-m-b-2 simple-content"><h1 id="HTTP连接配置"><a href="#HTTP连接配置" class="headerlink" title="HTTP连接配置"></a>HTTP连接配置</h1><h2 id="标准实现"><a href="#标准实现" class="headerlink" title="标准实现"></a>标准实现</h2><p><em>acceptCount</em><br>当所有可使用线程正在处理连接时,新进入请求连接的最大队列长度.当队列被填满,任何接收的请求都会被拒绝.其默认值为100.<br><a id="more"></a><br><em>maxConnections</em><br>服务器在任意时间能够接收和处理的最大连接数.当服务器处理的连接数达到maxConnections配置的数值时,服务器仍然会接收连接请求,但是不会处理任何多余的连接.这些多余的连接将会被阻塞,直到被处理的连接数降到maxConnections值以下,此时服务器再次开始接收和处理新的连接.需要注意的是,一旦达到这个限制值,操作系统可能仍然会继续接收连接,但是其接收的连接数需要依赖acceptCount的设置.maxConnections的默认值根据连接的类型而有所不同.对于BIO其默认值为<em>maxThreads</em>配置值,如果使用了Executor配置项,其默认值为配置的executor指定的最大线程数.对于NIO其默认值为10000.对于APR/native其默认值为8192.</p><p>需要注意的是,对于Windows上的APR/native,配置的值会降到1024的最大倍数但是会小于或者等于配置值.这是基于性能的原因.<br>如果配置值为-1,maxConnections配置项相关的特性将会被禁用,并且连接数将不会被计数统计.</p><p><em>maxThreads</em><br>Connector能够创建处理请求的线程的最大数,因此该值决定了服务器能够处理的最大的并发请求数.如果没有配置,该属性默认设置为200.如果executor配置关联上该Connector,此属性将会被忽略,Connector将会优先使用executor执行任务而不是内部的线程池.需要注意的是,如果executor对于该属性设置了任何有效的值,但是日志记录中会被记作-1以明确该属性未被使用.</p><h2 id="阻塞线程检测阀值"><a href="#阻塞线程检测阀值" class="headerlink" title="阻塞线程检测阀值"></a>阻塞线程检测阀值</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>该阀值允许探测那些需要花很长时间进行处理的请求,即那些处理过程中被阻塞的线程.此外它会尝试着中断这些线程并使之非阻塞.</p><p>当检测到上述请求时,处理该请求的线程会把当前的堆栈信息以WARN的级别写入Tomcat的日志中.</p><h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><p>Stuck Thread Detection Valve支持以下属性配置:</p><p><em>className</em><br>必须设置为org.apache.catalina.valves.StuckThreadDetectionValve.</p><p><em>threshold</em><br>认为线程被阻塞的最小值(秒).默认600s,如果设置为0,探测功能将被禁用.<br>注意:当容器(Engine,Host,Context)的后台线程指定了探测(或者中断)的阀值,该值必须高于此容器的backgroundProcessorDelay值.</p><p><em>interruptThreadThreshold</em><br>阻塞线程被中断和试图释放的最小时间(秒).<br>注意:不能百分百保证阻塞线程能够被释放.通常该机制对于I/O和锁阻塞的线程都运行良好.但是对于那些无限循环的线程可能就不起作用了.<br>默认值-1,表示禁用该机制.如果要启用此功能,该值应该大于等于threshold.</p><h2 id="连接数查看"><a href="#连接数查看" class="headerlink" title="连接数查看"></a>连接数查看</h2><p>实时查看tomcat并发连接数<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -na | grep ESTAB | grep 8080 | wc -l</span><br></pre></td></tr></table></figure><p></p><p>实时查看apache并发连接数<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -na | grep ESTAB | grep 80 | wc -l</span><br></pre></td></tr></table></figure><p></p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p>[1] <a href="http://tomcat.apache.org/tomcat-7.0-doc/config/valve.html" target="_blank" rel="noopener">The Valve Component</a><br>[2] <a href="http://tomcat.apache.org/tomcat-7.0-doc/config/http.html" target="_blank" rel="noopener">The HTTP Connector</a></p></div><div class="mdui-m-y-5 mdui-typo"><div class="simple-content-end mdui-valign"> 最后修改时间: 2018年10月09日 08:42:48<br> 原始链接:</div></div><div class="mdui-center mdui-text-center simple-post-author"><p> <img class="mdui-img-circle" src="/images/avatar.png"><br> <span class="mdui-typo-title">Jiang Dequan</span><br><br> <button class="mdui-btn mdui-ripple simple-donation-btn" mdui-dialog="{target: '#simple-donation'}"> <i class="mdui-icon mdui-icon-left material-icons">&#xe8dc;</i>稀罕作者</button></p></div><div class="mdui-divider mdui-m-t-5 mdui-m-b-1"></div><div class="mdui-row"><div class="mdui-col-md-1 mdui-col-offset-md-11 mdui-col-xs-1 mdui-col-offset-xs-11 simple-share"> <button class="mdui-btn mdui-ripple mdui-fab"> <i class="mdui-icon material-icons mdui-color-theme-accent">&#xe80d;</i></button></div></div><div class="mdui-m-b-2"> <a href="/tags/tomcat" class="mdui-btn mdui-btn-dense mdui-hoverable mdui-color-green simple-article-tags">tomcat</a> <a href="/tags/http" class="mdui-btn mdui-btn-dense mdui-hoverable mdui-color-deep-purple simple-article-tags">http</a></div></div></div></div><div class="mdui-row mdui-p-y-1"><div class="mdui-col-md-4 mdui-col-offset-md-1 mdui-col-xs-6 mdui-text-left mdui-typo"></div><div class="mdui-col-md-3 mdui-col-xs-6 mdui-text-right mdui-typo"> <a href="/2017/09/22/webserver/tomcat/how-to-integrate-logback-in-tomcat/">Tomcat中集成logback<label class="label-post-next">☞</label></a></div></div><div class="mdui-row mdui-p-t-1 mdui-p-b-3"><div class="mdui-col-md-7 mdui-col-offset-md-1 mdui-col-xs-12 mdui-col-offset-xs-0 mdui-shadow-12"><script src="/modules/valine/av-min.js"></script><script src="/modules/valine/Valine.min.js"></script><div id="vcomments"></div><script>new Valine({el:"#vcomments",appId:"MVdi2Xnz6HbmG6W1A7I8CAC8-gzGzoHsz",appKey:"Rl17wHDK3kufdMOx19dojo1h",placeholder:"想对作者说点什么?"})</script></div></div><script src="/js/post.js"></script></div><footer class="footer mdui-color-theme mdui-text-center"> <span>Jiang Dequan &copy; 2013 - 2018</span> . <span>Power by <a href="http://hexo.io/" target="_blank"><em>Hexo</em></a> Theme <a href="https://github.com/jiangdequan/hexo-theme-mdui" target="_blank"><em>mdui</em></a></span></footer> <button id="simple-scroll-btn" class="mdui-fab mdui-fab-fixed mdui-ripple mdui-fab-mini mdui-color-theme-accent simple-scroll-btn-cls"> <i class="mdui-icon material-icons">&#xe5d8;</i></button><div class="mdui-dialog simple-search-result-cls" id="simple-search-result"><div class="mdui-dialog-content"><div class="mdui-list"></div></div></div><script>$(document).ready(function(){var p,o=new mdui.Dialog("#simple-search-result"),e=algoliasearch("ARMI7PH3RU","6fd6458290f8f2087f2916caba9c8975").initIndex("github-blog"),h=$("#simple-search-result .mdui-list");$("#simple-input-search").keyup(function(){if(13===event.keyCode){var u=$(this).val();p!==u?(h.empty(),""!==u&&e.search({query:u},function(e,i){if(e)throw e;p=u;var l=i.hits,s=i.nbHits,a=i.processingTimeMS;if(h.append('<label class="mdui-list-item mdui-ripple"><img src="/images/algolia_logo.svg" style="height:18px;"/>&nbsp;&nbsp;  '+s+" results found in "+a+" ms</label>"),null==l||""===l||l.length<1)o.open();else{for(var t=0;t<l.length;t++){var n=l[t].slug,r=l[t]._highlightResult.title.value;h.append('<a href="/'+n+'" class="mdui-list-item mdui-ripple">'+r+"</a>")}o.open()}})):o.open()}})})</script><script src="/modules/mdui/js/mdui.min.js"></script><script src="/modules/busuanzi/2.3/busuanzi.pure.min.js"></script><script src="/modules/algolia/algoliasearchLite.min.js"></script><script src="/js/common.js"></script></body></html>